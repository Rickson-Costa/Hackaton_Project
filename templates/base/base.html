# ================================
# CORREÇÃO DE NOMES DE CAMPOS - SISTEMA FUNETEC
# ================================

# O erro mostra incompatibilidade entre os campos do modelo e do formulário
# Vamos padronizar tudo com snake_case (padrão Python)

# ============================================================================
# 1. CORRIGIR apps/contratos/forms/contrato_forms.py COMPLETAMENTE
# ============================================================================

"""
# Substitua TODO o conteúdo do arquivo por:

from django import forms
from ..models.contrato import Contrato

class ContratoForm(forms.ModelForm):
    class Meta:
        model = Contrato
        fields = [
            'descricao', 
            'cpf_cnpj',  # Corrigido
            'contratado', 
            'tipo_pessoa',  # Corrigido
            'data_inicio', 
            'data_fim',  # Corrigido
            'valor', 
            'parcelas', 
            'data_parcela_inicial',  # Corrigido
            'situacao'
        ]
        widgets = {
            'data_inicio': forms.DateInput(attrs={'type': 'date'}),
            'data_fim': forms.DateInput(attrs={'type': 'date'}),
            'data_parcela_inicial': forms.DateInput(attrs={'type': 'date'}),
            'tipo_pessoa': forms.Select(attrs={'class': 'form-select'}),
            'situacao': forms.Select(attrs={'class': 'form-select'}),
        }
        labels = {
            'cpf_cnpj': 'CPF/CNPJ',
            'tipo_pessoa': 'Tipo de Pessoa',
            'data_inicio': 'Data de Início da Vigência',
            'data_fim': 'Data de Fim da Vigência',
            'data_parcela_inicial': 'Vencimento da 1ª Parcela',
        }

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        for field_name, field in self.fields.items():
            if not isinstance(field.widget, forms.Select):
                field.widget.attrs.update({'class': 'form-control'})
"""

# ============================================================================
# 2. CORRIGIR apps/contratos/forms/pagamento_forms.py
# ============================================================================

"""
# Substitua TODO o conteúdo do arquivo por:

from django import forms
from ..models.item_contrato import ItemContrato

class PagamentoForm(forms.Form):
    valor_pago = forms.DecimalField(
        label="Valor a Pagar", 
        max_digits=14, 
        decimal_places=2,
        widget=forms.NumberInput(attrs={'class': 'form-control'})
    )
    data_pagamento = forms.DateField(
        label="Data do Pagamento",
        widget=forms.DateInput(attrs={'type': 'date', 'class': 'form-control'})
    )
    metodo_pagamento = forms.ChoiceField(
        label="Método de Pagamento",
        choices=[
            ('dinheiro', 'Dinheiro'),
            ('transferencia', 'Transferência'),
            ('pix', 'PIX'),
            ('cartao_credito', 'Cartão de Crédito'),
            ('cartao_debito', 'Cartão de Débito'),
            ('boleto', 'Boleto'),
        ],
        widget=forms.Select(attrs={'class': 'form-select'})
    )
    observacoes = forms.CharField(
        label="Observações",
        required=False,
        widget=forms.Textarea(attrs={'rows': 3, 'class': 'form-control'})
    )
"""

# ============================================================================
# 3. CORRIGIR templates/contratos/contrato_detail.html
# ============================================================================

"""
# Encontre e substitua as referências pelos nomes corretos:

# ANTES:
# {{ contrato.numContrato }}
# {{ contrato.codOrdem }}
# {{ contrato.cpfcnpj }}
# {{ contrato.get_tipoPessoa_display }}

# DEPOIS:
# {{ contrato.num_contrato }}
# {{ contrato.cod_ordem }}
# {{ contrato.cpf_cnpj }}
# {{ contrato.get_tipo_pessoa_display }}

# Versão corrigida completa:
{% extends 'base/base.html' %}

{% block title %}Contrato {{ contrato.num_contrato }}{% endblock %}
{% block page_title %}Detalhes do Contrato{% endblock %}

{% block page_actions %}
<a href="{% url 'contratos:contrato_list' %}" class="btn btn-secondary"><i class="fas fa-arrow-left me-1"></i> Voltar</a>
<a href="{% url 'contratos:contrato_update' contrato.pk %}" class="btn btn-primary"><i class="fas fa-edit me-1"></i> Editar</a>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-7">
        <div class="card shadow-sm">
            <div class="card-header"><h5 class="mb-0">Informações: {{ contrato.num_contrato }}</h5></div>
            <div class="card-body">
                <p><strong>Descrição:</strong> {{ contrato.descricao }}</p>
                <p><strong>Ordem de Serviço:</strong> <a href="{% url 'projetos:ordem_detail' contrato.cod_ordem.pk %}">#{{ contrato.cod_ordem.cod_ordem }}</a></p>
                <p><strong>Contratado:</strong> {{ contrato.contratado }} ({{ contrato.get_tipo_pessoa_display }})</p>
                <p><strong>CPF/CNPJ:</strong> {{ contrato.cpf_cnpj }}</p>
                <p><strong>Vigência:</strong> {{ contrato.data_inicio|date:"d/m/Y" }} a {{ contrato.data_fim|date:"d/m/Y" }}</p>
                <p><strong>Situação:</strong> <span class="badge bg-success">{{ contrato.get_situacao_display }}</span></p>
            </div>
        </div>
    </div>
    <div class="col-md-5">
        <div class="card shadow-sm">
            <div class="card-header"><h5 class="mb-0">Valores</h5></div>
            <div class="card-body">
                <p><strong>Valor Bruto:</strong> R$ {{ contrato.valor|floatformat:2 }}</p>
                <p><strong>Valor Líquido:</strong> R$ {{ contrato.valor_liquido|floatformat:2 }}</p>
                <p><strong>Valor Pago:</strong> R$ {{ contrato.valor_pago|floatformat:2 }}</p>
                <p><strong>Valor Pendente:</strong> <strong class="text-danger">R$ {{ contrato.valor_pendente|floatformat:2 }}</strong></p>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm mt-4">
    <div class="card-header"><h5 class="mb-0">Plano de Pagamento ({{ contrato.parcelas }} Parcela(s))</h5></div>
    <div class="card-body">
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            Sistema de parcelas em desenvolvimento. Em breve você poderá visualizar e gerenciar os pagamentos aqui.
        </div>
    </div>
</div>
{% endblock %}